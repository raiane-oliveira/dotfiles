customCommands:
  - key: 'n'
    context: 'localBranches'
    description: "Create new branch"
    prompts:
      - type: 'menu'
        title: 'What kind of branch is it?'
        key: 'BranchType'
        options:
          - name: 'feature'
            description: 'a feature branch'
            value: 'feat'
          - name: 'hotfix'
            description: 'a hotfix branch'
            value: 'hotfix'
          - name: 'fix'
            description: 'a fix branch'
            value: 'fix'
          - name: 'release'
            description: 'a release branch'
            value: 'release'
      - type: 'input'
        title: 'What is the new branch name?'
        key: 'BranchName'
        initialValue: ''
    # command: "git flow {{.Form.BranchType}} start {{.Form.BranchName}}"
    command: "git checkout -b {{.Form.BranchType}}/{{.Form.BranchName}}"
    loadingText: 'Creating branch'
  - key: "C" # ctrl + a
    description: "pick AI commit"
    command: |
      bash -c '
      if [ "{{.Form.Action}}" = "edit" ]; then
        echo "{{.Form.Msg}}" > .git/COMMIT_EDITMSG
        nvim .git/COMMIT_EDITMSG
        if [ -s .git/COMMIT_EDITMSG ]; then
          git commit -F .git/COMMIT_EDITMSG
        else
          echo "Commit message is empty, commit aborted."
        fi
      else
        git commit -m "{{.Form.Msg}}"
      fi
      '
    context: "files"
    output: none
    prompts:
      - type: "menuFromCommand"
        title: "AI Commit Message"
        key: "Msg"
        command: |
          bash -c '
          opencode run --model github-copilot/gpt-5-mini "Generate a single concise git commit message for the staged diff below.

          $(git diff --cached)

          Criteria:

          - Follow conventional commits format: <type>(<scope>): <description>
          - Only include scope if directly relevant
          - Abstract to intent and impact, not raw edits
          - Be clear, concise, and meaningful in project history
          - If multiple changes exist, synthesize into one coherent summary

          Examples:

          fix(app): add password regex validation
          test(unit): add missing edge case coverage
          refactor(api): simplify request handling
          style: remove unused imports

          Recent commits for tone reference:

          $(git log -n 10 --pretty=format:'"'"'%h %s'"'"')

          Output rules:

          - Output ONLY the raw commit message
          - No markdown
          - No backticks
          - No explanations
          - No extra whitespace

          Think carefully and produce the best single summary." 2>/dev/null | tail -n 1
          '
        filter: "^(?P<raw>.+)$"
        valueFormat: "{{ .raw }}"
        labelFormat: "{{ .raw | green }}"
      - type: "menu"
        title: "Choose Action"
        key: "Action"
        options:
          - name: "Commit directly"
            description: "Use this message as-is"
            value: "direct"
          - name: "Edit before commit"
            description: "Open in editor first"
            value: "edit"
